<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Project: QGIS Parking Management System - GIS Driver License</title><meta name="description" content=" The following are notes on an ongoing side project to turn QGIS into a tool for councils to manage their parking restrictions. It began as a simple shapefile and may one day evolve into a full blown software product. Notes have evolved over time&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://ggodfrey.gihub.io/publii/project-qgis-parking-management-system.html"><link rel="alternate" type="application/atom+xml" href="https://ggodfrey.gihub.io/publii/feed.xml"><link rel="alternate" type="application/json" href="https://ggodfrey.gihub.io/publii/feed.json"><meta property="og:title" content="Project: QGIS Parking Management System"><meta property="og:site_name" content="GIS Driver License"><meta property="og:description" content=" The following are notes on an ongoing side project to turn QGIS into a tool for councils to manage their parking restrictions. It began as a simple shapefile and may one day evolve into a full blown software product. Notes have evolved over time&hellip;"><meta property="og:url" content="https://ggodfrey.gihub.io/publii/project-qgis-parking-management-system.html"><meta property="og:type" content="article"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:var(--body-font);--logo-font:var(--body-font);--menu-font:var(--body-font)}</style><link rel="stylesheet" href="https://ggodfrey.gihub.io/publii/assets/css/style.css?v=3338deef7764b34eb54d4451f0abe482"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://ggodfrey.gihub.io/publii/project-qgis-parking-management-system.html"},"headline":"Project: QGIS Parking Management System","datePublished":"2020-10-15T20:41","dateModified":"2021-01-19T16:32","description":" The following are notes on an ongoing side project to turn QGIS into a tool for councils to manage their parking restrictions. It began as a simple shapefile and may one day evolve into a full blown software product. Notes have evolved over time&hellip;","author":{"@type":"Person","name":"George Godfrey"},"publisher":{"@type":"Organization","name":"George Godfrey"}}</script></head><body><div class="container js-container"><nav class="menu"><ul class="navbar__menu"><li><a href="https://ggodfrey.gihub.io/publii/" target="_self">Blog</a></li><li><a href="https://ggodfrey.gihub.io/publii/about-2.html" target="_self">About</a></li></ul></nav><div class="content"><header class="top"><div class="top__item"><a class="logo" href="https://ggodfrey.gihub.io/publii/">GIS Driver License</a></div><div class="top__item top__item--right"><button class="menu-toggle js-menu-toggle" aria-label="Menu" aria-expanded="false"><span class="menu-toggle-box"><span class="menu-toggle-inner">Menu</span></span></button></div></header><main class="main"><article class="post"><div class="main__left"><figure class="hero"><img src="https://ggodfrey.gihub.io/publii/media/website/London-2.PNG" srcset="https://ggodfrey.gihub.io/publii/media/website/responsive/London-2-xs.PNG 300w, https://ggodfrey.gihub.io/publii/media/website/responsive/London-2-sm.PNG 480w, https://ggodfrey.gihub.io/publii/media/website/responsive/London-2-md.PNG 768w, https://ggodfrey.gihub.io/publii/media/website/responsive/London-2-lg.PNG 1024w, https://ggodfrey.gihub.io/publii/media/website/responsive/London-2-xl.PNG 1280w, https://ggodfrey.gihub.io/publii/media/website/responsive/London-2-2xl.PNG 1600w" sizes="(min-width: 61.3125em) 50vw, 100vw" loading="eager" width="1606" height="676" alt=""></figure><header><h1>Project: QGIS Parking Management System</h1><p><time datetime="2020-10-15T20:41">October 15, 2020 </time>by <a href="https://ggodfrey.gihub.io/publii/authors/george-godfrey/" rel="author" title="George Godfrey">George Godfrey</a></p></header></div><div class="main__right"><div class="post__entry"><p></p><p>The following are notes on an ongoing side project to turn QGIS into a tool for councils to manage their parking restrictions. It began as a simple shapefile and may one day evolve into a full blown software product. Notes have evolved over time as I add functions and brainstorm ideas.</p><p></p><p></p><h2>The Concept</h2><p></p><p></p><p>Local Council's design and manage parking restrictions of the public highway. Traditionally this has all been done on paper and in many places still is. It seems crazy from my admittedly biased spatial / GIS view of the world.</p><p></p><p></p><p>My aim is to adapt QGIS to become a simple tool to help with this process.</p><p></p><p></p><p>In its simplest form you have a single line layer with the existing parking restrictions drawn, there are a few basic attributes for the type of restriction, a start and end date for when the restriction was installed. The lines are styled using the restriction type and then filtered using the start and end dates.</p><p></p><p></p><p>However there are many more complications and features which I would like to introduce.</p><p></p><p></p><h2>Background to the 'traffic orders process'</h2><p></p><p></p><p>Terminology:</p><p></p><p></p><ul><li>Restriction</li><li>Order</li><li>Proposal</li><li>Confirmed / Confirmed order:</li><li>Proposed / Proposed order:</li><li>Revoked / Revoke:</li><li>View date:</li></ul><p></p><p></p><h2>Data Structure</h2><p></p><p></p><p>Parking restrictions</p><p></p><p></p><p>Street furniture (lamp columns, sign posts, bollards etc) (points)</p><p></p><p></p><p>Construction lines</p><p></p><p></p><p>Lookup tables</p><p></p><p></p><h2>Data Format</h2><p></p><p></p><p>When considering which data format to use for this project I pondered a few options.</p><p></p><p></p><p>For the initial brain storm I created a 'Temporary Scratch Layer'. I use the '<a href="https://plugins.qgis.org/plugins/MemoryLayerSaver/">Memory Layer Saver</a>' plugin to make them a persistent part of the project file. It's the quickest, simplest option but not a long term solution.</p><p></p><p></p><p>They eventually got saved to a permeant shape file but there are <a href="https://bnhr.xyz/2018/12/12/i-choose-geopackage.html">limitations</a>.</p><p></p><p></p><p>PostGIS was an option, and probably is the best option long term with all the functionality it brings. Multi user editing, permissions, spatial SQL, unlimited storage, back ups, audit trails. However I decided against it, mostly for simplicities sake, also because I work offline quite allot and syncing to a server would be an additional complication at this early stage.</p><p></p><p></p><p>The happy middle ground was Geopackage. A single file database that can hold all my layers, layers styles and the QGIS project file. Can easily be copied and sent between users. At the moment it brings all the benefits I want from a database with the perks of a file format.</p><p></p><p></p><p>We'll see how the project evolves and whether I need to upgrade to a full database.</p><p></p><p></p><h2>View date filter</h2><p></p><p></p><h2>Traffic Orders lookup table</h2><p></p><p></p><h2>Linking traffic orders lookup table to drop down menu</h2><p></p><p></p><h2>Custom UI</h2><p></p><p></p><h2>Hiding columns</h2><p></p><p></p><h2>System values lookup table</h2><p></p><p></p><h2>Search bar</h2><p></p><p></p><p>Ideally I would like a search bar for navigating to specific roads</p><p></p><p></p><p>For now I use a combination of the 'zoom to postcode' plugin (excellent) and the 'Search Layers' plugin (also excellent but a bit slow to use).</p><p></p><p></p><h2>Digitising</h2><p></p><p></p><p>Restrictions</p><p></p><p></p><p>Construction lines</p><p></p><p></p><p>Advanced digitising panel / Snapping / Trace</p><p></p><p></p><p>Keyboard shortcuts</p><p></p><p></p><p>Custom UI</p><p></p><p></p><p>Styling</p><p></p><p></p><h2>Dims</h2><p></p><p></p><p>Adding CAD style dimensions to lines in QGIS has never been something I have perfectly resolved. The excellent QAD plugin for QGIS 2.X did a very good job of replicating them, with a few quirks. However it was never ported over to 3.X.</p><p></p><p></p><p>My solution is to use a geometry generator style and labels.</p><p></p><p></p><p>For simplicity this the geometry is included in the main 'parking restrictions' layer. The disadvantage is that it is included when you export the layer, complicates counts of items, is primarily a function of a proposal not the confirmed restrictions so needs to be toggled off.</p><p></p><p></p><p>Putting it in a seperate layer slows down editing. Without a plugin to make the toggling between layers slicker, I'm going to stick with it as is.</p><p></p><p></p><h2>Prototype One - traffic orders function</h2><p></p><p></p><p>After I had set up the basic layers / stylings / layouts / ui forms I made an attempt at some basic features. The idea was to create as much functionality as possible without any plugins.</p><p></p><p></p><p>Ideally you would open the 'software' and choose an order to edit before you began editing. Only proposed orders could be edited as confirmed orders are already sealed legal documents and installed on street. When a proposal becomes confirmed then you change the status of the order to confirmed, new items are permanently merged into the main 'confirmed orders' set and any revocations are carried out.</p><p></p><p></p><p><strong>Traffic Orders table</strong>: My simple solution is a data table which acts as a lookup list of 'orders'. This includes an 'id', 'order name', 'status' and 'effective date'.</p><p></p><p></p><p>In the form section of layer properties I set each field up to act differently. ID was auto incrementing UUID, status was value map which created a drop down menu with 'proposed' and 'confirmed', 'effective date' became a date type which shows a little calendar where you select the required date.</p><p></p><p></p><p><strong>Linking the orders table to the parking restrictions layer: </strong>This was achieved by creating a field called 'order name' and populating it using a 'Value Relation' form widget which links to the 'order name' field in the 'Traffic Orders' table. The result is a drop down menu containing all the existing 'order names'.</p><p></p><p></p><p><strong>Ensuring an order is always assigned to restriction</strong>: To make sure you can't plot a restriction which is effectively not part of an order I set the fields constraints to 'Not null' and 'enforce not null constraint'. Now you can't click ok until an order name option is selected.</p><p></p><p></p><p><strong>A workaround to allow a construction line type to bypass the order name IS NOT NULL constraint</strong>: Tried using an expression as the constraint but didn't work. Always acted as though the ELSE condition was true.</p><p></p><p></p><p><em>CASE WHEN "Type" IS NULL THEN "Order Name" IS NULL ELSE length("Order Name")&gt;0 END</em></p><p></p><p></p><p><strong>Adding proposal details to the restrictions ui / attributes:</strong> To achieve this I joined the Traffic Orders lookup table to the Parking Restrictions geometry table. Then added the 'order name', 'effective date' and 'status' fields to the form.</p><p></p><p></p><h2>PROTOTYPE ONE - <strong>View date filter</strong></h2><p></p><p></p><p>When dealing with a view of the confirmed order items we only only want to see restrictions that are active on a particular date, generally todays date. I achieved this with two components. The first is another lookup table where we define the view date, this allows us to filter by all items with an effective date &gt;= to the view date. The second part is a revocation system so we can extend the filter to be all items with an effective date &gt;= to the view date and smaller than the revocation date if applicable.</p><p></p><p></p><p>Lookup table</p><p></p><p></p><p>View date</p><p></p><p></p><p>Active Proposal</p><p></p><p></p><p>Revoked by</p><p></p><p></p><p>Joined revocation date</p><p></p><p></p><figure class="wp-block-image size-large"><a href="https://gisdriverslicence.files.wordpress.com/2020/10/image-3.png"><figure class="wp-image-341"><img loading="lazy" src="https://ggodfrey.gihub.io/publii/media/posts/40/image-3.png" sizes="(min-width: 61.3125em) 50vw, 100vw" srcset="https://ggodfrey.gihub.io/publii/media/posts/40/responsive/image-3-xs.png 300w, https://ggodfrey.gihub.io/publii/media/posts/40/responsive/image-3-sm.png 480w, https://ggodfrey.gihub.io/publii/media/posts/40/responsive/image-3-md.png 768w" alt=""></figure></a></figure><p></p><p></p><p>Every confirmed restriction has an 'effective date' (start) and optionally a 'revocation date' (end). I want a simple tool where I enter a date and it filters the 'parking restrictions' layer so that only items which existed on street on that day are visible.</p><p></p><p></p><p>The bodge so far is to add a 'view date' field to the 'System Values' data table. Then append this value to every line in the 'Parking Restrictions' table using a virtual field. Using this expression:</p><p></p><p></p><p><em>attribute (&nbsp; get_feature_by_id( 'System Values',&nbsp; 1)&nbsp;&nbsp; , 'View Date')</em></p><p></p><p></p><p>Then using a rule based symbology to filter</p><p></p><p></p><p>How to turn that into a plugin, displayed in a panel, I'm unsure so far.</p><p></p><p></p><h2>Create a Plugin that Updates the System Values Table</h2><p></p><p></p><p>The code below opens a view of the active layer data table, without the buttons/frame that comes with the normal attributes table.</p><p></p><p></p><p>To open a specific table, change 'activeLayer' in the layer section to be specific table name. e.g. change <em>layer = iface.activeLayer()</em> to <em>layer = iface.System Values()</em></p><p></p><p></p><pre class="wp-block-syntaxhighlighter-code">layer = iface.activeLayer()

canvas = iface.mapCanvas()
vector_layer_cache = QgsVectorLayerCache(layer, 10000)
attribute_table_model = QgsAttributeTableModel(vector_layer_cache)
attribute_table_model.loadLayer()

attribute_table_filter_model = QgsAttributeTableFilterModel(canvas, attribute_table_model)
attribute_table_view = QgsAttributeTableView()
attribute_table_view.setModel(attribute_table_filter_model)

attribute_table_view.show()</pre><p></p><p></p><figure class="wp-block-image size-large"><a href="https://gisdriverslicence.files.wordpress.com/2020/10/image-9.png"><figure class="wp-image-370"><img loading="lazy" src="https://ggodfrey.gihub.io/publii/media/posts/40/image-9.png" sizes="(min-width: 61.3125em) 50vw, 100vw" srcset="https://ggodfrey.gihub.io/publii/media/posts/40/responsive/image-9-xs.png 300w, https://ggodfrey.gihub.io/publii/media/posts/40/responsive/image-9-sm.png 480w, https://ggodfrey.gihub.io/publii/media/posts/40/responsive/image-9-md.png 768w" alt=""></figure></a></figure><p></p><p></p><p>The next bit of code toggles on editing for a layer.</p><p></p><p></p><p></p><p></p><footer><div class="post__tag-share"><div class="post__share"></div></div><div class="post__bio"><h3><a href="https://ggodfrey.gihub.io/publii/authors/george-godfrey/" title="George Godfrey">George Godfrey</a></h3></div></footer></div></div></article></main><footer class="footer"><div class="footer__copyright">Powered by <a href="https://getpublii.com" target="_blank" rel="nofollow noopener">Publii</a></div></footer></div></div><script defer="defer" src="https://ggodfrey.gihub.io/publii/assets/js/scripts.min.js?v=babd20e2a0a25821e63a0529c9feaae0"></script><script>var images = document.querySelectorAll('img[loading]');
   
           for (var i = 0; i < images.length; i++) {
               if (images[i].complete) {
                   images[i].classList.add('is-loaded');
               } else {
                   images[i].addEventListener('load', function () {
                       this.classList.add('is-loaded');
                   }, false);
               }
           }</script></body></html>